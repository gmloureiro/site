<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Admin ‚Äì Marketplace de SDRs INBOTIX</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Painel administrativo do marketplace de SDRs INBOTIX. Visualize SDRs, avalia√ß√µes e empresas que solicitaram contato.">
  <link rel="icon" type="image/png" href="logo-inbotix.png" />

  <style>
    :root {
      --primary: #0f6fff;
      --primary-dark: #0050c8;
      --bg: #f3f4f6;
      --bg-card: #ffffff;
      --border: #d1d5db;
      --border-soft: #e5e7eb;
      --text: #111827;
      --muted: #6b7280;
      --danger: #b91c1c;
      --success: #15803d;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top left, #e0ecff 0, #f9fafb 40%, #ffffff 100%);
      color: var(--text);
      min-height: 100vh;
    }

    a { color: inherit; text-decoration: none; }

    header {
      background: #ffffff;
      border-bottom: 1px solid rgba(148, 163, 184, 0.35);
      padding: 12px 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      box-shadow: 0 8px 22px rgba(15, 23, 42, 0.08);
      position: sticky;
      top: 0;
      z-index: 20;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .header-left img {
      height: 32px;
      width: auto;
    }

    .header-title {
      font-size: 13px;
      color: var(--muted);
    }
    .header-title strong {
      display: block;
      font-size: 15px;
      color: var(--text);
    }

    .header-right {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      align-items: center;
      justify-content: flex-end;
    }

    .btn-header {
      border-radius: 999px;
      border: 1px solid rgba(15, 111, 255, 0.5);
      padding: 6px 12px;
      font-size: 11px;
      color: var(--primary-dark);
      background: #eff6ff;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-weight: 600;
    }

    main {
      max-width: 1120px;
      margin: 18px auto 32px;
      padding: 0 16px 40px;
    }

    .page-grid {
      display: grid;
      grid-template-columns: 2.1fr 1.4fr;
      gap: 16px;
    }

    @media (max-width: 900px) {
      .page-grid { grid-template-columns: minmax(0, 1fr); }
    }

    .card {
      background: var(--bg-card);
      border-radius: 18px;
      border: 1px solid var(--border-soft);
      box-shadow: 0 14px 32px rgba(15, 23, 42, 0.08);
      padding: 14px 16px 16px;
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      gap: 8px;
      align-items: baseline;
      margin-bottom: 8px;
    }

    .card-title {
      font-size: 14px;
      font-weight: 700;
      color: var(--text);
    }

    .card-sub {
      font-size: 11px;
      color: var(--muted);
      max-width: 42ch;
    }

    .badge {
      font-size: 11px;
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: #f9fafb;
      color: var(--muted);
    }

    .badge-success {
      border-color: rgba(34, 197, 94, 0.6);
      color: var(--success);
      background: #ecfdf3;
    }

    .badge-danger {
      border-color: rgba(239, 68, 68, 0.6);
      color: var(--danger);
      background: #fef2f2;
    }

    .badge-pill {
      border-radius: 999px;
      font-size: 10px;
      padding: 3px 7px;
      background: #eff6ff;
      border: 1px solid #bfdbfe;
      color: #1d4ed8;
    }

    .section {
      margin-bottom: 18px;
    }

    .section-title {
      font-size: 13px;
      font-weight: 700;
      margin-bottom: 6px;
      color: var(--text);
    }

    .section-sub {
      font-size: 11px;
      color: var(--muted);
      margin-bottom: 8px;
    }

    .stat-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 10px;
    }

    .stat {
      font-size: 11px;
      padding: 5px 9px;
      border-radius: 999px;
      background: #f9fafb;
      border: 1px solid var(--border-soft);
    }

    .table-wrapper {
      border-radius: 12px;
      border: 1px solid var(--border-soft);
      overflow: auto;
      max-height: 360px;
      background: #f9fafb;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 11px;
      min-width: 600px;
    }

    thead {
      position: sticky;
      top: 0;
      background: #e5e7eb;
      z-index: 1;
    }

    th, td {
      padding: 6px 8px;
      border-bottom: 1px solid var(--border-soft);
      text-align: left;
    }

    th {
      font-weight: 600;
      color: #374151;
      border-bottom: 1px solid #d1d5db;
    }

    tbody tr:nth-child(even) {
      background: #f3f4f6;
    }

    tbody tr:hover {
      background: #e5f0ff;
    }

    .text-right { text-align: right; }
    .text-center { text-align: center; }

    .pill {
      border-radius: 999px;
      padding: 2px 6px;
      font-size: 10px;
      border: 1px solid var(--border-soft);
      background: #f9fafb;
      white-space: nowrap;
    }

    .pill-green {
      border-color: rgba(34, 197, 94, 0.6);
      background: #ecfdf3;
      color: #166534;
    }

    .pill-yellow {
      border-color: #facc15;
      background: #fefce8;
      color: #92400e;
    }

    .pill-blue {
      border-color: #60a5fa;
      background: #eff6ff;
      color: #1d4ed8;
    }

    .stars {
      display: inline-flex;
      gap: 1px;
    }

    .star {
      font-size: 12px;
      color: #e5e7eb;
    }

    .star.filled {
      color: #facc15;
    }

    .empty {
      font-size: 11px;
      color: var(--muted);
      text-align: center;
      padding: 10px;
    }

    .btn {
      border-radius: 999px;
      border: 1px solid var(--border);
      background: #f9fafb;
      padding: 6px 11px;
      font-size: 11px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 5px;
    }

    .btn-primary {
      border-color: transparent;
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      color: #ffffff;
      box-shadow: 0 10px 24px rgba(15, 111, 255, 0.6);
      font-weight: 600;
    }

    .btn-sm {
      padding: 4px 8px;
      font-size: 10px;
    }

    .btn-group {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-bottom: 8px;
    }

    .badge-key {
      font-family: monospace;
      font-size: 10px;
      padding: 2px 5px;
      border-radius: 6px;
      border: 1px dashed #cbd5f5;
      background: #eff6ff;
      color: #1e3a8a;
    }

    .small-text {
      font-size: 10px;
      color: var(--muted);
    }

    .mt-4 { margin-top: 4px; }
    .mt-8 { margin-top: 8px; }
  </style>
</head>
<body>
  <header>
    <div class="header-left">
      <a href="https://inbotix.com.br">
        <img src="logo-inbotix.png" alt="INBOTIX">
      </a>
      <div class="header-title">
        <strong>Admin ‚Äì Marketplace de SDRs</strong>
        Visualiza√ß√£o local dos dados salvos no navegador.
      </div>
    </div>
    <div class="header-right">
      <span class="badge-pill">üîí Ambiente de testes / localStorage</span>
      <a href="sdr-lista.html" class="btn-header">Ver vitrine de SDRs</a>
      <a href="sdr-ranking.html" class="btn-header">Ranking de SDRs</a>
      <a href="sdr-cadastro.html" class="btn-header">Cadastro de SDR</a>
    </div>
  </header>

  <main>
    <div class="page-grid">
      <!-- COLUNA ESQUERDA: SDRs, notas e m√©tricas -->
      <section class="card">
        <div class="card-header">
          <div>
            <div class="card-title">Vis√£o geral dos SDRs</div>
            <div class="card-sub">
              Lista de SDRs cadastrados em <span class="badge-key">inbotix_sdrs</span>, com m√©dia de avalia√ß√µes,
              n√∫mero de coment√°rios e posi√ß√£o no ranking.
            </div>
          </div>
          <span class="badge" id="sdr-count-badge">Carregando‚Ä¶</span>
        </div>

        <div class="section">
          <div class="section-title">Estat√≠sticas r√°pidas</div>
          <div class="stat-row">
            <div class="stat" id="stat-total-sdrs">Total de SDRs: 0</div>
            <div class="stat" id="stat-avaliados">SDRs com avalia√ß√µes: 0</div>
            <div class="stat" id="stat-media-geral">M√©dia geral das notas: ‚Äì</div>
          </div>
        </div>

        <div class="section">
          <div class="section-title">SDRs cadastrados</div>
          <div class="section-sub">
            Em produ√ß√£o, esses dados viriam do backend. Aqui √© apenas uma visualiza√ß√£o do que est√° salvo no navegador.
          </div>

          <div class="table-wrapper" id="sdr-table-wrapper">
            <table>
              <thead>
                <tr>
                  <th>SDR</th>
                  <th>Cidade / Regi√£o</th>
                  <th class="text-center">M√©dia</th>
                  <th class="text-center">Avalia√ß√µes</th>
                  <th>Flags</th>
                </tr>
              </thead>
              <tbody id="sdr-tbody">
                <tr><td colspan="5" class="empty">Nenhum SDR cadastrado ainda.</td></tr>
              </tbody>
            </table>
          </div>
        </div>

        <div class="section mt-8">
          <div class="section-title">Chaves usadas no localStorage</div>
          <div class="section-sub">
            √ötil para debug ou para mapear o que voc√™ vai persistir depois no banco de dados real.
          </div>
          <div class="stat-row">
            <span class="badge-key">inbotix_sdrs</span>
            <span class="badge-key">inbotix_sdr_config</span>
            <span class="badge-key">inbotix_sdr_leads</span>
          </div>
          <p class="small-text mt-4">
            Em produ√ß√£o, esses dados devem ser buscados via API (ex: <em>/api/sdrs</em>, <em>/api/leads</em>) e
            n√£o diretamente do navegador.
          </p>
        </div>
      </section>

      <!-- COLUNA DIREITA: LEADS QUE PEDIRAM TELEFONE -->
      <section class="card">
        <div class="card-header">
          <div>
            <div class="card-title">Empresas que solicitaram o telefone do SDR</div>
            <div class="card-sub">
              Toda vez que algu√©m clicou em <strong>‚ÄúChamar no WhatsApp‚Äù</strong> na vitrine e preencheu os dados,
              o registro foi salvo em <span class="badge-key">inbotix_sdr_leads</span>.
            </div>
          </div>
          <span class="badge badge-success" id="lead-count-badge">0 leads</span>
        </div>

        <div class="section">
          <div class="section-title">Exportar cadastros</div>
          <div class="btn-group">
            <button type="button" class="btn btn-primary btn-sm" id="btn-export-csv">
              ‚¨á Exportar CSV
            </button>
            <button type="button" class="btn btn-sm" id="btn-export-json">
              ‚¨á Exportar JSON
            </button>
            <button type="button" class="btn btn-sm" id="btn-clear-leads">
              üóë Limpar leads (apenas localStorage)
            </button>
          </div>
          <p class="small-text">
            Os arquivos gerados podem ser importados depois em um CRM, planilha ou enviados para o time operacional.
          </p>
        </div>

        <div class="section">
          <div class="section-title">Lista de empresas interessadas</div>
          <div class="section-sub">
            Cada linha representa um formul√°rio preenchido antes de liberar o n√∫mero de WhatsApp de um SDR.
          </div>

          <div class="table-wrapper" id="leads-table-wrapper">
            <table>
              <thead>
                <tr>
                  <th>Data</th>
                  <th>Contato / Empresa</th>
                  <th>SDR</th>
                  <th>E-mail</th>
                  <th>Telefone</th>
                </tr>
              </thead>
              <tbody id="leads-tbody">
                <tr><td colspan="5" class="empty">Nenhum lead registrado ainda.</td></tr>
              </tbody>
            </table>
          </div>
        </div>

        <div class="section mt-8">
          <div class="section-title">Observa√ß√µes para produ√ß√£o</div>
          <ul class="small-text" style="padding-left: 16px; list-style: disc;">
            <li>Em produ√ß√£o, cada registro deve ser persistido no banco (ex: <em>lead_sdr_requests</em>).</li>
            <li>Voc√™ pode vincular esse cadastro a pipelines de CRM (ex: ‚ÄúInteresse em SDR / Prospec√ß√£o‚Äù).</li>
            <li>Interessante ter um campo de <em>origem</em> (ex: ‚ÄúMarketplace SDR INBOTIX‚Äù).</li>
          </ul>
        </div>
      </section>
    </div>
  </main>

  <script>
    const SDR_KEY = "inbotix_sdrs";
    const SDR_LEADS_KEY = "inbotix_sdr_leads";

    let sdrs = [];
    let leads = [];

    const sdrCountBadge = document.getElementById("sdr-count-badge");
    const statTotalSdrs = document.getElementById("stat-total-sdrs");
    const statAvaliados = document.getElementById("stat-avaliados");
    const statMediaGeral = document.getElementById("stat-media-geral");
    const sdrTbody = document.getElementById("sdr-tbody");

    const leadCountBadge = document.getElementById("lead-count-badge");
    const leadsTbody = document.getElementById("leads-tbody");

    const btnExportCsv = document.getElementById("btn-export-csv");
    const btnExportJson = document.getElementById("btn-export-json");
    const btnClearLeads = document.getElementById("btn-clear-leads");

    function loadSdrs() {
      try {
        sdrs = JSON.parse(localStorage.getItem(SDR_KEY) || "[]");
      } catch (e) {
        sdrs = [];
      }

      sdrs = sdrs.map(s => ({
        premium: !!s.premium,
        verified: !!s.verified,
        usaInbotix: !!s.usaInbotix,
        reviews: Array.isArray(s.reviews) ? s.reviews : [],
        ...s
      }));
    }

    function loadLeads() {
      try {
        leads = JSON.parse(localStorage.getItem(SDR_LEADS_KEY) || "[]");
      } catch (e) {
        leads = [];
      }
      // Ordena por data desc
      leads.sort((a, b) => {
        const da = a.createdAt ? new Date(a.createdAt).getTime() : 0;
        const db = b.createdAt ? new Date(b.createdAt).getTime() : 0;
        return db - da;
      });
    }

    function getRatingInfo(sdr) {
      const reviews = sdr.reviews || [];
      if (!reviews.length) return { avg: 0, count: 0 };
      const sum = reviews.reduce((acc, r) => acc + (r.stars || 0), 0);
      return { avg: sum / reviews.length, count: reviews.length };
    }

    function createStars(avg) {
      const rounded = Math.round(avg * 2) / 2;
      let html = '<span class="stars">';
      for (let i = 1; i <= 5; i++) {
        const filled = i <= Math.round(rounded) ? " filled" : "";
        html += '<span class="star' + filled + '">‚òÖ</span>';
      }
      html += "</span>";
      return html;
    }

    function renderSdrs() {
      if (!sdrs.length) {
        sdrTbody.innerHTML = '<tr><td colspan="5" class="empty">Nenhum SDR cadastrado ainda.</td></tr>';
        sdrCountBadge.textContent = "0 SDRs";
        statTotalSdrs.textContent = "Total de SDRs: 0";
        statAvaliados.textContent = "SDRs com avalia√ß√µes: 0";
        statMediaGeral.textContent = "M√©dia geral das notas: ‚Äì";
        return;
      }

      sdrCountBadge.textContent = sdrs.length + (sdrs.length === 1 ? " SDR" : " SDRs");
      statTotalSdrs.textContent = "Total de SDRs: " + sdrs.length;

      let totalNotas = 0;
      let totalAvaliados = 0;

      const rows = sdrs.slice().map(sdr => {
        const info = getRatingInfo(sdr);
        if (info.count) {
          totalNotas += info.avg;
          totalAvaliados++;
        }

        const flags = [];
        if (sdr.premium) flags.push('<span class="pill pill-yellow">Premium</span>');
        if (sdr.verified) flags.push('<span class="pill pill-green">Verificado</span>');
        if (sdr.usaInbotix) flags.push('<span class="pill pill-blue">Usa stack INBOTIX</span>');

        const cidadeRegiao = [
          (sdr.cidade || "").trim(),
          (sdr.regioes || "").trim()
        ].filter(Boolean).join(" ‚Ä¢ ");

        const ratingHtml = info.count
          ? createStars(info.avg) +
            '<div class="small-text">' +
            info.avg.toFixed(1).replace(".", ",") +
            " em " +
            info.count +
            (info.count === 1 ? " avalia√ß√£o" : " avalia√ß√µes") +
            "</div>"
          : '<span class="small-text">Sem avalia√ß√µes ainda</span>';

        return `
          <tr>
            <td>
              <strong>${sdr.nome || "SDR"}</strong><br>
              <span class="small-text">${(sdr.nicho || "").substring(0, 70)}</span>
            </td>
            <td>${cidadeRegiao || "-"}</td>
            <td class="text-center">${ratingHtml}</td>
            <td class="text-center">${info.count || 0}</td>
            <td>${flags.join(" ") || "-"}</td>
          </tr>
        `;
      });

      sdrTbody.innerHTML = rows.join("");

      statAvaliados.textContent = "SDRs com avalia√ß√µes: " + totalAvaliados;
      if (totalAvaliados) {
        const mediaGeral = totalNotas / totalAvaliados;
        statMediaGeral.textContent = "M√©dia geral das notas: " + mediaGeral.toFixed(2).replace(".", ",");
      } else {
        statMediaGeral.textContent = "M√©dia geral das notas: ‚Äì";
      }
    }

    function renderLeads() {
      const total = leads.length;
      leadCountBadge.textContent = total + (total === 1 ? " lead" : " leads");

      if (!total) {
        leadsTbody.innerHTML = '<tr><td colspan="5" class="empty">Nenhum lead registrado ainda.</td></tr>';
        leadCountBadge.classList.remove("badge-danger");
        leadCountBadge.classList.add("badge-success");
        return;
      }

      leadCountBadge.classList.remove("badge-success");
      leadCountBadge.classList.add("badge-danger");

      const rows = leads.map(l => {
        const dt = l.createdAt ? new Date(l.createdAt) : null;
        const dataStr = dt ? dt.toLocaleDateString("pt-BR") + " " + dt.toLocaleTimeString("pt-BR", { hour: "2-digit", minute: "2-digit" }) : "-";

        const sdrNome = l.sdrNome || (() => {
          const s = sdrs.find(s => s.id === l.sdrId);
          return s ? s.nome : "";
        })();

        return `
          <tr>
            <td>${dataStr}</td>
            <td>
              <strong>${l.nome || "-"}</strong><br>
              <span class="small-text">${l.empresa || "-"}</span>
            </td>
            <td>
              <span class="small-text">#${l.sdrId || "-"} ‚Ä¢ ${sdrNome || ""}</span>
            </td>
            <td>${l.email || "-"}</td>
            <td>${l.telefone || "-"}</td>
          </tr>
        `;
      });

      leadsTbody.innerHTML = rows.join("");
    }

    function exportCsv() {
      if (!leads.length) {
        alert("N√£o h√° leads para exportar.");
        return;
      }

      const header = [
        "id",
        "sdrId",
        "sdrNome",
        "nome",
        "empresa",
        "email",
        "telefone",
        "createdAt"
      ];

      const csvRows = [];
      csvRows.push(header.join(";"));

      leads.forEach(l => {
        const row = header.map(key => {
          const val = (l[key] !== undefined && l[key] !== null) ? String(l[key]) : "";
          const cleaned = val.replace(/"/g, '""');
          return `"${cleaned}"`;
        });
        csvRows.push(row.join(";"));
      });

      const blob = new Blob([csvRows.join("\n")], { type: "text/csv;charset=utf-8;" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "inbotix_sdr_leads.csv";
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    function exportJson() {
      if (!leads.length) {
        alert("N√£o h√° leads para exportar.");
        return;
      }
      const blob = new Blob([JSON.stringify(leads, null, 2)], { type: "application/json;charset=utf-8;" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "inbotix_sdr_leads.json";
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    function clearLeads() {
      if (!confirm("Tem certeza que deseja apagar TODOS os leads de inbotix_sdr_leads neste navegador?")) {
        return;
      }
      localStorage.removeItem(SDR_LEADS_KEY);
      leads = [];
      renderLeads();
    }

    btnExportCsv.addEventListener("click", exportCsv);
    btnExportJson.addEventListener("click", exportJson);
    btnClearLeads.addEventListener("click", clearLeads);

    function init() {
      loadSdrs();
      loadLeads();
      renderSdrs();
      renderLeads();
    }

    init();
  </script>
</body>
</html>
